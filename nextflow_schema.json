{
  "$schema": "http://json-schema.org/draft-07/schema",
  "$id": "https://raw.githubusercontent.com/angelovangel/nxf-alignment/master/nextflow_schema.json",
  "title": "angelovangel/nxf-alignment",
  "workflow_title": "NXF-ALIGNMENT workflow",
  "description": "Basecall, align, and analyze ONT data",
  "url": "https://github.com/angelovangel/nxf-alignment",
  "type": "object",
  "definitions": {
    "basecalling_options": {
      "title": "Basecalling/Input reads options",
      "type": "object",
      "fa_icon": "fas fa-angle-double-right",
      "description": "Choose basecalling or input reads, adaptive sampling decisions file (optional), kit and samplesheet (for barcoded run).",
      "properties": {
        "pod5": {
          "type": "string",
          "format": "directory-path",
          "fa_icon": "fas fa-folder-open",
          "description": "Directory with POD5 files (use when basecalling)",
          "help_text": "Path to directory containing POD5 files for basecalling. If this is selected then basecalling will be performed (do not select reads)."
        },
        "model": {
          "type": "string",
          "description": "Dorado basecalling model",
          "fa_icon": "fas fa-microchip",
          "default": "fast",
          "help_text": "Name of the Dorado model to use for basecalling. Default is 'fast'. For modifications, use for example 'hac,5mCG_5hmCG'. See how to use [Dorado models here](https://software-docs.nanoporetech.com/dorado/latest/models/selection/)."
        },
        "reads": {
          "type": "string",
          "format": "path",
          "fa_icon": "fas fa-file",
          "description": "BAM/FASTQ file or directory of reads (skips basecalling)",
          "help_text": "Path to a single BAM/FASTQ file or directory containing multiple read files (each file is a sample). If this is selected then basecalling will be skipped (do not select pod5)."
        },
        "asfile": {
          "type": "string",
          "format": "file-path",
          "fa_icon": "fas fa-filter",
          "description": "Adaptive sampling CSV file",
          "help_text": "CSV file from adaptive sampling that filters which reads to basecall (use when adaptive sampling run). This file is generated by MinKNOW during an adaptive sampling run, and can be found under `runfolder/adaptive_sampling/AS_decisions.csv`"
        },
        "kit": {
          "type": "string",
          "description": "Barcoding kit name",
          "fa_icon": "fas fa-barcode",
          "help_text": "Name of the barcoding kit used. Required when run is barcoded.",
          "enum": [
            "SQK-16S024",
            "SQK-16S114-24",
            "SQK-NBD114-24",
            "SQK-NBD114-96",
            "SQK-PCB114-24",
            "SQK-RBK114-24",
            "SQK-RBK114-96",
            "SQK-RPB114-24",
            "TWIST-16-UDI",
            "TWIST-96A-UDI",
            "VSK-PTC001",
            "VSK-VMK001",
            "VSK-VMK004",
            "VSK-VPS001"
          ]
        },
        "samplesheet": {
          "type": "string",
          "format": "file-path",
          "fa_icon": "fas fa-vials",
          "mimetype": "text/csv",
          "description": "CSV file with sample and barcode information",
          "help_text": "Samplesheet CSV file must contain at least columns 'sample' and 'barcode'. Required when run is barcoded."
        }
      },
      "oneOf": [
        {
          "required": [
            "pod5",
            "model"
          ]
        },
        {
          "required": [
            "reads"
          ]
        }
      ]
    },
    "alignment_options": {
      "title": "Alignment options",
      "type": "object",
      "fa_icon": "fas fa-cogs",
      "description": "Options for alignment.",
      "required": [
        "ref"
      ],
      "properties": {
        "ref": {
          "type": "string",
          "format": "file-path",
          "fa_icon": "fas fa-dna",
          "description": "Reference FASTA file",
          "help_text": "Path to reference FASTA file for alignment. Required unless using -entry basecall."
        },
        "bed": {
          "type": "string",
          "format": "file-path",
          "fa_icon": "fas fa-map",
          "description": "BED file with regions of interest",
          "help_text": "BED file defining regions of interest with 4 columns (chrom, start, end, name). If omitted, will be auto-generated from the reference file."
        }
      }
    },
    "variant_calling_options": {
      "title": "Variant calling options",
      "type": "object",
      "fa_icon": "fas fa-dna",
      "description": "Options for variant calling using Clair3.",
      "properties": {
        "variants": {
          "type": "boolean",
          "description": "Enable variant calling with Clair3",
          "fa_icon": "fas fa-check-square",
          "default": false,
          "help_text": "Set to true to enable variant calling on the aligned reads using Clair3."
        },
        "clair3_platform": {
          "type": "string",
          "description": "Clair3 platform to use",
          "fa_icon": "fas fa-microchip",
          "default": "ont",
          "enum": [
            "ont",
            "hifi",
            "ilmn"
          ],
          "help_text": "The platform for which the Clair3 model was trained. Only used when --variants is specified."
        },
        "clair3_model": {
          "type": "string",
          "description": "Clair3 model to use",
          "fa_icon": "fas fa-cog",
          "default": "r1041_e82_400bps_hac_v500",
          "help_text": "The specific Clair3 model name. Only used when --variants is specified. Examples: r1041_e82_400bps_hac_v500, hifi_revio, etc. See available models in the Clair3 documentation."
        },
        "annotate": {
          "type": "boolean",
          "description": "Enable variant annotation with snpEff",
          "fa_icon": "fas fa-check-square",
          "default": false,
          "help_text": "Set to true to enable variant annotation on the variant calls using snpEff. Only used when --variants is specified."
        },
        "anno_db": {
          "type": "string",
          "description": "snpEff database to use",
          "fa_icon": "fas fa-database",
          "default": "hg38",
          "enum": [
            "hg38",
            "hg19",
            "mm10",
            "mm39",
            "rn5",
            "rn6"
          ],
          "help_text": "The snpEff database to use. Use the same database version as the reference genome used in alignment. Check snpEff documentation for available databases (we do not support custom databases)."
        }
      }
    },
    "other_options": {
      "title": "Other options",
      "type": "object",
      "fa_icon": "fas fa-question-circle",
      "description": "Output and other options",
      "help_text": "Output and other options",
      "required": [
        "outdir"
      ],
      "properties": {
        "outdir": {
          "type": "string",
          "description": "The name of the output directory where the results will be saved",
          "fa_icon": "fas fa-poll",
          "default": "output",
          "help_text": "It is recommended to not change the default output directory"
        }
      }
    }
  },
  "allOf": [
    {
      "$ref": "#/definitions/basecalling_options"
    },
    {
      "$ref": "#/definitions/alignment_options"
    },
    {
      "$ref": "#/definitions/variant_calling_options"
    },
    {
      "$ref": "#/definitions/other_options"
    }
  ]
}